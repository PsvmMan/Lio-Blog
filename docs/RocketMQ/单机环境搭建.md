## **1. 单机环境搭建**
### **1.1 安装RocketMQ**
1. 把下载的rocketmq-all-4.9.1-bin-release.zip在本地完成解压
2. 把文件上传到linux服务器的/usr/local/rocketmq目录

```java
mkdir /usr/local/rocketmq
```

3. 修改环境变量，这样RocketMQ就安装完成了，可以将它运行起来了

```java
//编辑文件
vim /etc/profile
//将下面内容添加到文件中
export ROCKETMQ_HOME=/usr/local/rocketmq/rocketmq-all-4.9.1-bin-release
export PATH=$PATH:$ROCKETMQ_HOME/bin
//让环境变量生效
source /etc/profile
```

### **1.2 NameServer服务搭建**
1. 到`/usr/local/rocketmq/rocketmq-all-4.9.1-bin-release/bin`目录下修改`vim runserver.sh`，调整JVM内存大小，在脚本中找到和下面语句类似的那一行，替换为下面语句

```properties
JAVA_OPT="${JAVA_OPT} -server -Xms512m -Xmx512m -Xmn256m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"
```

2. 到`/usr/local/rocketmq/rocketmq-all-4.9.1-bin-release/bin`目录下，给bin所有文件执行权限

```java
chmod 777 *
```

3. 到`/usr/local/rocketmq/rocketmq-all-4.9.1-bin-release/bin`目录下，启动服务，其实不用到bin目录，因为我们配置了环境变量

```java
//启动，默认的监听端口是9876
nohup sh  mqnamesrv > /dev/null 2>&1  &
//查看服务是否启动成功，可以看到有一个NamesrvStartup进程
jps
//查看日志
tail -f ~/logs/rocketmqlogs/namesrv.log
//关闭
sh mqshutdown namesrv
```

### **1.3 Broker服务搭建**
1. 到`/usr/local/rocketmq/rocketmq-all-4.9.1-bin-release/bin`目录下修改`vim runbroker.sh`，调整JVM内存大小，在脚本中找到和下面语句类似的那一行，替换为下面语句

```properties
JAVA_OPT="${JAVA_OPT} -server -Xms256m -Xmx256m"
```

2. 到`/usr/local/rocketmq/rocketmq-all-4.9.1-bin-release/conf/broker.conf`，加如下配置。如果生产者尝试发送消息到一个尚未在Broker上创建的主题，Broker会自动创建这个主题，并允许消息发送成功。

```properties
autoCreateTopicEnable = true
```

3. 到`/usr/local/rocketmq/rocketmq-all-4.9.1-bin-release`目录下，启动服务，其实不用到bin目录，因为我们配置了环境变量

```java
//启动
nohup sh  mqbroker > /dev/null 2>&1  &
//指定NameServer的ip和端口，指定配置文件的方式启动
nohup sh  mqbroker -n 192.168.204.130:9876 -c /usr/local/rocketmq/rocketmq-all-4.9.1-bin-release/conf/broker.conf  > /dev/null 2>&1  &
//查看服务是否启动成功，可以看到一个BrokerStartup进程
jps
//查看日志
tail -f ~/logs/rocketmqlogs/broker.log
//关闭
sh mqshutdown broker
```





